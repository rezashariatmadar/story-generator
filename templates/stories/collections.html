{% extends 'base.html' %}
{% load static %}

{% block title %}My Collections - AI Story Generator{% endblock %}

{% block extra_css %}
<style>
.collection-card {
    border: none;
    border-radius: 15px;
    transition: all 0.3s ease;
    background: linear-gradient(135deg, #f8f9fa, #ffffff);
}

.collection-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.collection-icon {
    font-size: 2rem;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}

.genre-tag {
    font-size: 0.75rem;
    padding: 2px 8px;
    border-radius: 10px;
    background: rgba(111, 66, 193, 0.1);
    color: #6f42c1;
}

.collection-stats {
    background: rgba(111, 66, 193, 0.05);
    border-radius: 10px;
    padding: 15px;
}

.uncategorized-card {
    border: 2px dashed #dee2e6;
    background: #f8f9fa;
}

.create-collection-card {
    border: 2px dashed #6f42c1;
    background: linear-gradient(135deg, rgba(111, 66, 193, 0.05), rgba(111, 66, 193, 0.1));
    cursor: pointer;
    transition: all 0.3s ease;
}

.create-collection-card:hover {
    background: linear-gradient(135deg, rgba(111, 66, 193, 0.1), rgba(111, 66, 193, 0.15));
    transform: translateY(-3px);
}
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1><i class="fas fa-layer-group text-primary"></i> My Collections</h1>
            <p class="text-muted">Organize your stories into collections and folders</p>
        </div>
        <a href="{% url 'stories:create_collection' %}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Create Collection
        </a>
    </div>

    <!-- Summary Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card border-0 bg-primary text-white">
                <div class="card-body text-center">
                    <i class="fas fa-layer-group fa-2x mb-2"></i>
                    <h3>{{ total_collections }}</h3>
                    <small>Collections</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 bg-info text-white">
                <div class="card-body text-center">
                    <i class="fas fa-file-alt fa-2x mb-2"></i>
                    <h3>{{ uncategorized_count }}</h3>
                    <small>Uncategorized</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 bg-success text-white">
                <div class="card-body text-center">
                    <i class="fas fa-book fa-2x mb-2"></i>
                    <h3>{{ collection_stats|length|add:uncategorized_count }}</h3>
                    <small>Total Stories</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 bg-warning text-white">
                <div class="card-body text-center">
                    <i class="fas fa-words fa-2x mb-2"></i>
                    <h3>{% for stat in collection_stats %}{{ stat.total_words|add:0 }}{% endfor %}</h3>
                    <small>Total Words</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Collections Grid -->
    <div class="row g-4">
        <!-- Create New Collection Card -->
        <div class="col-md-6 col-lg-4">
            <div class="card create-collection-card h-100" onclick="window.location.href='{% url 'stories:create_collection' %}'">
                <div class="card-body text-center d-flex flex-column justify-content-center">
                    <i class="fas fa-plus text-primary" style="font-size: 3rem; margin-bottom: 20px;"></i>
                    <h5 class="text-primary">Create New Collection</h5>
                    <p class="text-muted">Organize your stories into themed collections</p>
                </div>
            </div>
        </div>

        <!-- Uncategorized Stories -->
        {% if uncategorized_count > 0 %}
        <div class="col-md-6 col-lg-4">
            <div class="card uncategorized-card h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="collection-icon" style="background: #6c757d;">
                            <i class="fas fa-folder-open"></i>
                        </div>
                        <div class="ms-3">
                            <h5 class="mb-0">Uncategorized</h5>
                            <small class="text-muted">Stories without a collection</small>
                        </div>
                    </div>
                    
                    <div class="collection-stats">
                        <div class="row text-center">
                            <div class="col">
                                <strong>{{ uncategorized_count }}</strong>
                                <br><small>Stories</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <a href="{% url 'stories:my_stories' %}?collection=none" class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-eye"></i> View Stories
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- User Collections -->
        {% for stat in collection_stats %}
        <div class="col-md-6 col-lg-4">
            <div class="card collection-card h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="collection-icon" style="background: {{ stat.collection.color }};">
                            <i class="{{ stat.collection.icon }}"></i>
                        </div>
                        <div class="ms-3 flex-grow-1">
                            <h5 class="mb-0">{{ stat.collection.name }}</h5>
                            <small class="text-muted">{{ stat.collection.description|default:"No description" }}</small>
                            {% if stat.collection.is_default %}
                                <br><span class="badge bg-primary">Default</span>
                            {% endif %}
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{% url 'stories:collection_detail' stat.collection.id %}">
                                    <i class="fas fa-eye"></i> View Stories
                                </a></li>
                                <li><a class="dropdown-item" href="{% url 'stories:edit_collection' stat.collection.id %}">
                                    <i class="fas fa-edit"></i> Edit Collection
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="{% url 'stories:delete_collection' stat.collection.id %}">
                                    <i class="fas fa-trash"></i> Delete Collection
                                </a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="collection-stats mb-3">
                        <div class="row text-center">
                            <div class="col-4">
                                <strong>{{ stat.story_count }}</strong>
                                <br><small>Stories</small>
                            </div>
                            <div class="col-4">
                                <strong>{{ stat.total_words|floatformat:0 }}</strong>
                                <br><small>Words</small>
                            </div>
                            <div class="col-4">
                                <strong>{{ stat.collection.average_rating|floatformat:1|default:"N/A" }}</strong>
                                <br><small>Avg Rating</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Genre Distribution -->
                    {% if stat.genre_distribution %}
                    <div class="mb-3">
                        <small class="text-muted">Popular Genres:</small>
                        <div class="mt-1">
                            {% for genre, count in stat.genre_distribution.items %}
                                <span class="genre-tag me-1">{{ genre }} ({{ count }})</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Recent Stories -->
                    {% if stat.recent_stories %}
                    <div class="mb-3">
                        <small class="text-muted">Recent Stories:</small>
                        {% for story in stat.recent_stories %}
                        <div class="mt-1">
                            <small>
                                <i class="fas fa-file-alt text-muted"></i>
                                <a href="{% url 'stories:story_detail' story.id %}" class="text-decoration-none">
                                    {{ story.title|default:"Untitled"|truncatechars:30 }}
                                </a>
                            </small>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <div class="d-flex gap-2">
                        <a href="{% url 'stories:collection_detail' stat.collection.id %}" class="btn btn-primary btn-sm flex-grow-1">
                            <i class="fas fa-folder-open"></i> Open
                        </a>
                        <a href="{% url 'stories:edit_collection' stat.collection.id %}" class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-edit"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% if not collection_stats and uncategorized_count == 0 %}
    <!-- Empty State -->
    <div class="text-center py-5">
        <i class="fas fa-layer-group text-muted" style="font-size: 4rem; opacity: 0.3;"></i>
        <h3 class="mt-3 text-muted">No Collections Yet</h3>
        <p class="text-muted">Create your first collection to organize your stories!</p>
        <a href="{% url 'stories:create_collection' %}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Create Your First Collection
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
// Add some interactive feedback
document.addEventListener('DOMContentLoaded', function() {
    // Add hover effects to collection cards
    const collectionCards = document.querySelectorAll('.collection-card');
    collectionCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.borderLeft = '4px solid #6f42c1';
        });
        card.addEventListener('mouseleave', function() {
            this.style.borderLeft = 'none';
        });
    });
});
</script>
{% endblock %} 